<!DOCTYPE html><meta charset="utf-8"><title>Simulacra.js</title><meta name="description" content="One-way data binding for web applications."><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="index.css"><script src="simulacra.js"></script><header><h1>Simulacra.js</h1><h2>One-way data binding for web applications.</h2><code>npm install simulacra --save</code> <a href="simulacra.js" class="button">Download</a> <a href="https://github.com/0x8890/simulacra" id="corner"><span>Fork on</span> GitHub</a></header><div class="example"><div class="container"><div class="left"><div class="product-container"></div></div><div class="right"><code>Some things to try:</code><ul><li><code>data.name = "Caramel Latte"</code></li><li><code>data.details.size = ["L", "XL"]</code></li></ul><input type="text" name="eval" placeholder="Change data..."></div></div></div><article><h2 id="usage">Usage<a class="anchor" href="#usage" title="Link to this section “Usage”">#</a></h2><p>Simulacra.js uses plain old HTML with nothing that is coupled with implementation for templating. Here&#39;s a sample template, note that it&#39;s just a <code>&lt;template&gt;</code> tag without any data-binding attributes:</p><pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">template</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"product"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">h1</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"name"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"details"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"size"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">h4</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"vendor"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">h4</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">template</span>&gt;</span>
</code></pre><p>In the above template, there are no iteration mechanisms, because Simulacra.js will automatically clone DOM elements based on the data. Here&#39;s some sample data:</p><pre><code class="lang-js"><span class="hljs-title">var</span> <span class="hljs-typedef"><span class="hljs-keyword">data</span> = <span class="hljs-container">{
  <span class="hljs-title">name</span>: '<span class="hljs-type">Pumpkin</span> <span class="hljs-type">Spice</span> <span class="hljs-type">Latte</span>',
  <span class="hljs-title">details</span>: {
    <span class="hljs-title">size</span>: [ '<span class="hljs-type">Tall</span>', '<span class="hljs-type">Grande</span>', '<span class="hljs-type">Venti</span>' ],
    <span class="hljs-title">vendor</span>: '<span class="hljs-type">Starbucks</span>'
  }</span></span>
}
</code></pre><p>Simulacra.js exports only a single function, which does different things based on the types of the arguments. There are 3 use cases: defining mount/unmount functions for an element, defining nested bindings for an element, and defining a binding for a data object.</p><pre><code class="lang-js"><span class="hljs-keyword">var</span> σ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'simulacra'</span>) <span class="hljs-comment">// or `window.simulacra`</span>
<span class="hljs-keyword">var</span> τ = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">s</span>) </span>{ <span class="hljs-keyword">return</span> fragment.querySelector(s) }

<span class="hljs-keyword">var</span> fragment = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'#product'</span>).content
<span class="hljs-keyword">var</span> bindings = σ(fragment, {
  name: σ(τ(<span class="hljs-string">'.name'</span>)),
  details: σ(τ(<span class="hljs-string">'.details'</span>), {
    size: σ(τ(<span class="hljs-string">'.size'</span>)),
    vendor: σ(τ(<span class="hljs-string">'.vendor'</span>))
  })
})

<span class="hljs-built_in">document</span>.appendChild(σ(data, bindings))
</code></pre><p>The DOM will update <em>if and only if</em> any of the bound data keys are assigned. All mount functions are &quot;offline&quot; operations, they mutate elements which exist only in memory. By default, the key value will be assigned to the element&#39;s <code>textContent</code> property, additional functions for mounting and unmounting may be used for arbitrary element manipulation.</p><h2 id="benchmarks">Benchmarks<a class="anchor" href="#benchmarks" title="Link to this section “Benchmarks”">#</a></h2><p>Simulacra.js is even faster than consecutively setting the <code>innerHTML</code> property. Based on the <a href="https://lhorie.github.io/mithril/benchmarks.html">benchmarks</a> from Mithril.js, here&#39;s how it compares. Tests ran on a mid-2014 Macbook Pro using Chrome 46. All times are rounded to the nearest millisecond.</p><div class="table-wrapper"><table><thead><tr><th style="text-align:left">Name</th><th style="text-align:left">Loading</th><th>Scripting</th><th>Rendering</th><th>Painting</th><th>Other</th></tr></thead><tbody><tr><td style="text-align:left">Simulacra.js</td><td style="text-align:left">1 ms</td><td>9 ms</td><td>7 ms</td><td>27 ms</td><td>12 ms</td></tr><tr><td style="text-align:left"><em>innerHTML</em></td><td style="text-align:left">35 ms</td><td>32 ms</td><td>5 ms</td><td>24 ms</td><td>10 ms</td></tr><tr><td style="text-align:left">Mithril.js</td><td style="text-align:left">7 ms</td><td>69 ms</td><td>17 ms</td><td>25 ms</td><td>19 ms</td></tr><tr><td style="text-align:left">jQuery</td><td style="text-align:left">11 ms</td><td>101 ms</td><td>17 ms</td><td>25 ms</td><td>23 ms</td></tr><tr><td style="text-align:left">React.js</td><td style="text-align:left">8 ms</td><td>109 ms</td><td>15 ms</td><td>26 ms</td><td>22 ms</td></tr><tr><td style="text-align:left">Angular.js</td><td style="text-align:left">8 ms</td><td>115 ms</td><td>15 ms</td><td>28 ms</td><td>26 ms</td></tr></tbody></table></div><h2 id="how-it-works">How it Works<a class="anchor" href="#how-it-works" title="Link to this section “How it Works”">#</a></h2><p>On initialization, Simulacra.js removes bound elements from the document and replaces them with a empty text node (marker) for memoizing its position. Based on a key value, it clones template elements and applies the DOM operations on the cloned elements, and appends them next to the marker.</p><h2 id="caveats">Caveats<a class="anchor" href="#caveats" title="Link to this section “Caveats”">#</a></h2><p>The DOM will update <em>if and only if</em> there is an assignment on the object, since it uses a property setter under the hood. This means that using the <code>delete</code> keyword will not trigger a DOM update. Also, arrays need to be assigned after a mutation, even if it is mutated in place.</p><h2 id="under-the-hood">Under the Hood<a class="anchor" href="#under-the-hood" title="Link to this section “Under the Hood”">#</a></h2><p>This library is written in ES5 syntactically, and makes use of:</p><ul><li>Object property getters &amp; setters (ES5)</li><li>WeakMap (ES6)</li><li>DocumentFragment (DOM Level 1)</li><li>TreeWalker (DOM Level 2)</li><li>Node.isEqualNode (DOM Level 3)</li><li>Node.contains (DOM Living Standard)</li></ul><p>No polyfills are included.</p><h2 id="license">License<a class="anchor" href="#license" title="Link to this section “License”">#</a></h2><p>This software is licensed under the <a href="https://raw.githubusercontent.com/0x8890/simulacra/master/LICENSE">MIT license</a>.</p></article><template id="product"><h1 class="name"></h1><div class="details"><div><span class="size"></span></div><h4 class="vendor"></h4></div></template><script type="text/javascript">(function () {
  window.data = {
    name: 'Pumpkin Spice Latte',
    details: {
      size: [ 'Tall', 'Grande', 'Venti' ],
      vendor: 'Starbucks'
    }
  }

  var bind = window.simulacra
  var fragment = document.getElementById('product').content
  function $ (s) { return fragment.querySelector(s) }

  var bindings = bind(fragment, {
    name: bind($('.name')),
    details: bind($('.details'), {
      size: bind($('.size')),
      vendor: bind($('.vendor'))
    })
  })

  var output = bind(data, bindings)
  document.querySelector('.product-container').appendChild(output)

  var input = document.querySelector('input[name="eval"]')
  input.addEventListener('keyup', function (event) {
    if (event.keyCode === 13) {
      var x = input.value
      input.value = ''
      eval(x)
    }
  })
}())</script>